# 🎉 部署成功！后续步骤指南

## ✅ 部署状态

**应用已成功启动！**

从日志可以看到：
- ✅ 服务器进程已启动
- ✅ 应用启动完成
- ✅ Facebook平台已注册和初始化
- ✅ Instagram平台已注册和初始化
- ✅ 数据库表已创建/验证
- ✅ 自动回复调度器已启动
- ✅ 摘要通知调度器已启动
- ✅ Uvicorn正在运行在端口8080

## ⚠️ 可选警告（不影响主要功能）

```
WARNING - Instagram platform initialized but INSTAGRAM_USER_ID not configured
```

**说明**：
- 这是可选配置
- 如果不使用Instagram功能，可以忽略
- 如果需要Instagram功能，可以后续添加`INSTAGRAM_USER_ID`环境变量

## 🚀 下一步操作

### 第1步：获取应用URL

1. 在Zeabur控制台
2. 找到您的应用服务
3. 在服务页面找到**应用URL**
4. 格式类似：`https://your-app-name.zeabur.app`
5. **复制这个URL**，后面要用

### 第2步：运行数据库迁移

1. 在应用服务页面
2. 点击 **"Terminal"**（终端）标签
3. 等待终端连接（会进入容器内部）
4. 输入命令：
   ```bash
   alembic upgrade head
   ```
5. 按回车执行
6. 等待迁移完成
7. 看到 "Migration complete" 或类似信息表示成功

### 第3步：测试应用

#### 测试健康检查

在浏览器访问：
```
https://your-app-name.zeabur.app/health/simple
```

**预期结果**：
```json
{
  "status": "ok",
  "timestamp": "2025-12-15...",
  "message": "Service is running"
}
```

#### 测试API文档

访问：
```
https://your-app-name.zeabur.app/docs
```

应该能看到Swagger API文档页面。

### 第4步：配置Facebook Webhook

1. **获取应用URL**
   - 从Zeabur控制台复制应用URL
   - 格式：`https://your-app-name.zeabur.app`

2. **配置Webhook**
   - 访问：https://developers.facebook.com
   - 登录您的账号
   - 进入您的应用设置
   - 找到 **"Webhooks"**（Webhook）设置

3. **添加Webhook**
   - 点击 **"Add Callback URL"**（添加回调URL）
   - 填写以下信息：
     - **Callback URL**：`https://your-app-name.zeabur.app/webhook`
       （替换为您的实际URL）
     - **Verify Token**：与`FACEBOOK_VERIFY_TOKEN`环境变量一致
       （您之前设置的值）
   - 点击 **"Verify and Save"**（验证并保存）

4. **订阅事件**
   - 勾选以下事件：
     - ✅ `messages` - 消息
     - ✅ `messaging_postbacks` - 回传
     - ✅ `feed` - 评论（如果需要）

5. **验证成功**
   - Webhook状态显示为"已订阅"（Subscribed）
   - 绿色勾号表示验证成功

### 第5步：测试功能

#### 测试Webhook接收

1. 在Facebook Messenger中，向您的页面发送测试消息
2. 在Zeabur控制台，查看应用日志
3. 应该能看到消息接收的日志：
   ```
   INFO: Received Facebook webhook event
   INFO: Processing message from user: ...
   ```

#### 测试AI回复

1. 发送一条需要AI回复的消息
2. 等待几秒钟
3. 检查是否收到AI自动回复

## 📋 部署完成检查清单

- [ ] 应用状态为"Running"（绿色）
- [ ] 健康检查通过（/health/simple返回ok）
- [ ] API文档可访问（/docs）
- [ ] 数据库迁移已运行（alembic upgrade head）
- [ ] Facebook Webhook已配置
- [ ] Webhook验证成功（绿色勾号）
- [ ] 测试消息可以接收
- [ ] AI回复功能正常

## 🎯 应用功能说明

### 已启动的功能

1. **Facebook消息接收**
   - 自动接收Facebook消息
   - 支持私信、评论等

2. **AI自动回复**
   - 集成OpenAI API
   - 自动生成智能回复
   - 每5分钟扫描未回复消息

3. **数据收集**
   - 自动提取客户信息
   - 保存到数据库

4. **Telegram通知**
   - 自动发送通知到Telegram
   - 摘要调度器已启动

5. **数据库管理**
   - 数据库连接正常
   - 表结构已创建

## 🔧 可选配置

### 如果需要Instagram功能

添加环境变量：
- `INSTAGRAM_USER_ID` - Instagram用户ID

**如何获取**：
1. 访问Instagram Graph API
2. 获取您的Instagram Business账户ID
3. 添加到环境变量

### 监控和日志

- **查看日志**：在Zeabur控制台 → 应用服务 → "Logs"
- **查看状态**：在服务页面查看运行状态
- **查看指标**：在服务页面查看资源使用情况

## 🆘 常见问题

### Q1: 如何查看应用日志？

**A**: 在Zeabur控制台 → 应用服务 → "Logs"标签

### Q2: 如何重启应用？

**A**: 在服务页面点击"Restart"按钮

### Q3: 如何修改环境变量？

**A**: 在服务页面 → "Environment Variables" → 修改后自动重启

### Q4: Webhook验证失败？

**A**: 
- 检查Webhook URL是否正确
- 检查Verify Token是否与`FACEBOOK_VERIFY_TOKEN`一致
- 确认应用正在运行

## 🎉 恭喜！

您的应用已经成功部署并运行！

现在可以：
- 接收Facebook消息
- 自动回复客户
- 收集客户数据
- 发送Telegram通知

---

**下一步**：按照上面的步骤完成数据库迁移和Webhook配置，然后就可以开始使用了！

